{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eduke | Profile Settings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="{% static 'images/logobase_white.png' %}">
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd', 400: '#a78bfa',
                            500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 800: '#5b21b6', 900: '#4c1d95',
                        },
                        accent: { fuchsia: '#d946ef', indigo: '#6366f1', rose: '#f43f5e', amber: '#f59e0b', emerald: '#10b981' }
                    },
                    animation: {
                        'shimmer': 'shimmer 2s linear infinite',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'fade-in': 'fadeIn 0.4s ease-in-out forwards',
                    },
                    keyframes: {
                        shimmer: { '100%': { transform: 'translateX(100%)' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            overflow: hidden;
        }

        .dark body {
            background-color: #020617;
        }

        #spotlight {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: radial-gradient(circle at var(--x) var(--y), rgba(139, 92, 246, 0.15) 0%, transparent 45%);
            z-index: 1;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.05);
        }

        .dark .glass-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .input-field {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.4);
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            font-weight: bold;
            color: #1e293b;
            transition: all 0.3s;
        }

        .dark .input-field {
            background-color: rgba(2, 6, 23, 0.4);
            border-color: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .input-field:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
            background-color: #fff;
            outline: none;
        }

        .dark .input-field:focus {
            background-color: #0f172a;
        }

        .success-toast {
            animation: toastInCentral 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards,
                toastOutCentral 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards 2.5s;
        }

        @keyframes toastInCentral {
            from {
                transform: translateY(-150%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes toastOutCentral {
            from {
                transform: translateY(0);
                opacity: 1;
            }

            to {
                transform: translateY(-200%);
                opacity: 0;
            }
        }

        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #8b5cf633;
            border-radius: 10px;
        }
    </style>
</head>

<body class="antialiased">
    <div id="spotlight"></div>

    {% if messages %}
    <div id="notification-container"
        class="fixed top-8 inset-x-0 z-[100] flex flex-col items-center justify-center pointer-events-none px-4">
        {% for message in messages %}
        <div
            class="success-toast pointer-events-auto flex items-center gap-4 bg-white dark:bg-slate-900 border-b-4 border-emerald-500 p-5 rounded-2xl shadow-2xl min-w-[320px] max-w-md">
            <div
                class="w-10 h-10 bg-emerald-500/10 rounded-full flex items-center justify-center text-emerald-500 flex-shrink-0">
                <i class="fa-solid fa-check-double"></i>
            </div>
            <div>
                <p class="text-xs font-black uppercase tracking-widest text-slate-400">Update Successful</p>
                <p class="text-sm font-bold text-slate-700 dark:text-slate-200">{{ message }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="relative z-10 flex h-screen p-0 lg:p-6 gap-0 lg:gap-6 overflow-hidden">
        <aside id="sidebar"
            class="fixed inset-y-0 left-0 z-50 w-72 transform -translate-x-full lg:translate-x-0 lg:static transition-transform duration-500 ease-in-out h-[100dvh] lg:h-full">
            <div
                class="flex flex-col h-full glass-sidebar lg:rounded-[3rem] shadow-2xl overflow-hidden border-r border-white/5 bg-[#0a0a14]/80 backdrop-blur-xl">
                <div class="p-8 pb-4 shrink-0 flex items-center justify-between">
                    <div class="flex items-center gap-3 group cursor-pointer">
                        <div
                            class="w-10 h-10 rounded-xl flex items-center justify-center border border-slate-200 dark:border-white/10 bg-white/10 dark:bg-white/5 group-hover:rotate-12 transition-transform animate-pulse bg-gradient-to-r from-brand-500 via-accent-fuchsia to-indigo-500 bg-[length:200%_200%]">
                            <img src="{% static 'images/logobase_white.png' %}" alt="Eduke Logo"
                                class="w-6 h-6 object-contain animate-color-cycle">
                        </div>
                        <div>
                            <h2 class="text-xl font-black tracking-tighter text-white uppercase text-nowrap">
                                Eduke<span class="text-accent-fuchsia">.</span>
                            </h2>
                            <p class="text-[8px] font-black text-brand-400 uppercase tracking-[0.3em]">Portal</p>
                        </div>
                    </div>

                    <button id="close-sidebar"
                        class="lg:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-white/5 text-slate-400 hover:text-white transition-all">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>


                <nav class="flex-grow px-4 space-y-4 overflow-y-auto custom-scroll py-2">

                    <div>
                        <p class="px-6 text-[9px] font-black text-slate-500 uppercase tracking-[0.4em] mb-2">Command</p>
                        <div class="space-y-1">

                            <a href="{% url 'institution:dashboard' %}" class="relative flex items-center gap-3 px-6 py-2.5 rounded-xl transition-all duration-300 group
                        {% if request.resolver_match.url_name == 'dashboard' %} 
                            bg-brand-500/10 border border-brand-500/20 text-white 
                        {% else %} 
                            text-slate-400 hover:text-white hover:bg-white/5 border border-transparent 
                        {% endif %}">

                                {% if request.resolver_match.url_name == 'dashboard' %}
                                <span
                                    class="absolute left-2 w-1 h-4 bg-brand-500 rounded-full shadow-[0_0_10px_#8b5cf6]"></span>
                                {% endif %}

                                <i
                                    class="fa-solid fa-layer-group text-base {% if request.resolver_match.url_name == 'dashboard' %} text-brand-400 {% else %} group-hover:text-brand-400 {% endif %}"></i>
                                <span class="font-bold text-sm">Dashboard</span>
                            </a>

                            <a href="{% url 'institution:manage_student' %}" class="relative flex items-center gap-3 px-6 py-2.5 rounded-xl transition-all duration-300 group
                        {% if request.resolver_match.url_name == 'manage_student' %} 
                            bg-accent-fuchsia/10 border border-accent-fuchsia/20 text-white 
                        {% else %} 
                            text-slate-400 hover:text-white hover:bg-white/5 border border-transparent 
                        {% endif %}">

                                {% if request.resolver_match.url_name == 'manage_student' %}
                                <span
                                    class="absolute left-2 w-1 h-4 bg-accent-fuchsia rounded-full shadow-[0_0_10px_#d946ef]"></span>
                                {% endif %}

                                <i
                                    class="fa-solid fa-user-shield text-base {% if request.resolver_match.url_name == 'manage_student' %} text-accent-fuchsia {% else %} group-hover:text-accent-fuchsia {% endif %}"></i>
                                <span class="font-bold text-sm">Students</span>
                            </a>
                        </div>
                    </div>

                    <div>
                        <p class="px-6 text-[9px] font-black text-slate-500 uppercase tracking-[0.4em] mb-2">Operations
                        </p>
                        <div class="space-y-1">

                            <a href="{% url 'institution:classes' %}" class="relative flex items-center gap-3 px-6 py-2.5 rounded-xl transition-all duration-300 group
                        {% if request.resolver_match.url_name == 'classes' %} 
                            bg-brand-500/10 border border-brand-500/20 text-white 
                        {% else %} 
                            text-slate-400 hover:text-white hover:bg-white/5 border border-transparent 
                        {% endif %}">

                                {% if request.resolver_match.url_name == 'classes' %}
                                <span
                                    class="absolute left-2 w-1 h-4 bg-brand-500 rounded-full shadow-[0_0_10px_#8b5cf6]"></span>
                                {% endif %}

                                <i
                                    class="fa-solid fa-chalkboard-user text-base {% if request.resolver_match.url_name == 'classes' %} text-brand-400 {% else %} group-hover:text-brand-400 {% endif %}"></i>
                                <span class="font-bold text-sm">Manage Classes</span>
                            </a>

                            <a href="{% url 'institution:subjects' %}" class="relative flex items-center gap-3 px-6 py-2.5 rounded-xl transition-all duration-300 group
                        {% if request.resolver_match.url_name == 'subjects' %} 
                            bg-emerald-500/10 border border-emerald-500/20 text-white 
                        {% else %} 
                            text-slate-400 hover:text-white hover:bg-white/5 border border-transparent 
                        {% endif %}">

                                {% if request.resolver_match.url_name == 'subjects' %}
                                <span
                                    class="absolute left-2 w-1 h-4 bg-emerald-500 rounded-full shadow-[0_0_10px_#10b981]"></span>
                                {% endif %}

                                <i
                                    class="fa-solid fa-book-open-reader text-base {% if request.resolver_match.url_name == 'subjects' %} text-emerald-400 {% else %} group-hover:text-emerald-400 {% endif %}"></i>
                                <span class="font-bold text-sm">Subject Head</span>
                            </a>
                        </div>
                    </div>

                    <div class="pt-2">
                        <p class="px-6 text-[9px] font-black text-slate-500 uppercase tracking-[0.4em] mb-2">User</p>
                        <div class="space-y-1">
                            <a href="{% url 'institution:profile' %}" class="relative flex items-center gap-3 px-6 py-2.5 rounded-xl transition-all duration-300 group
                        {% if request.resolver_match.url_name == 'profile' %} 
                            bg-brand-500/10 border border-brand-500/20 text-white 
                        {% else %} 
                            text-slate-400 hover:text-white hover:bg-white/5 border border-transparent 
                        {% endif %}">

                                {% if request.resolver_match.url_name == 'profile' %}
                                <span
                                    class="absolute left-2 w-1 h-4 bg-brand-500 rounded-full shadow-[0_0_10px_#8b5cf6]"></span>
                                {% endif %}

                                <i
                                    class="fa-solid fa-circle-user text-base {% if request.resolver_match.url_name == 'profile' %} text-brand-400 {% else %} group-hover:text-brand-400 {% endif %}"></i>
                                <span class="font-bold text-sm">{{ institution.abbreviation|default:"User" }}
                                    Profile</span>
                            </a>
                        </div>
                    </div>
                </nav>

                <div class="p-4 shrink-0 mt-auto mb-2 lg:mb-4">
                    <div
                        class="relative overflow-hidden group bg-white/5 backdrop-blur-xl border border-white/10 rounded-[2rem] p-4 flex flex-col gap-3 transition-all hover:border-white/20">
                        <div class="flex items-center gap-3">
                            <div class="relative flex-shrink-0">
                                <div
                                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-400 to-brand-600 flex items-center justify-center border border-white/20 shadow-lg">
                                    <span
                                        class="text-[11px] font-black text-white uppercase">{{institution.abbreviation|default:"EDU" }}
                                        </span>
                                </div>
                                <div
                                    class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 border-2 border-[#12121e] rounded-full">
                                </div>
                            </div>
                            <div class="min-w-0 flex-1">
                                <h4 class="text-[11px] font-black text-white truncate tracking-tight mb-0.5">
                                  {{  institution.name|default:"Main Campus" }}</h4>
                                <p class="text-[9px] font-bold text-slate-500 uppercase tracking-widest leading-none">
                                    Admin</p>
                            </div>
                        </div>
                        <div class="h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
                        <a href="{% url 'logout' %}"
                            class="group/btn relative flex items-center justify-between px-4 py-2.5 rounded-xl bg-rose-500/5 hover:bg-rose-500 border border-rose-500/20 hover:border-rose-500 transition-all duration-300">
                            <span
                                class="text-[9px] font-black uppercase tracking-widest text-rose-400 group-hover/btn:text-white">Logout</span>
                            <i
                                class="fa-solid fa-power-off text-[10px] text-rose-500 group-hover/btn:text-white transition-colors"></i>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0">
            <header class="h-24 flex items-center justify-between px-8 animate-fade-in">
                <div class="flex items-center gap-6">
                    <button id="menu-btn"
                        class="lg:hidden w-12 h-12 flex items-center justify-center rounded-2xl glass-card text-brand-600">
                        <i class="fa-solid fa-bars-staggered"></i>
                    </button>
                    <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tighter">
                        Institution <span
                            class="bg-gradient-to-r from-brand-500 to-accent-indigo bg-clip-text text-transparent">Profile</span>
                    </h1>
                </div>
                <button id="theme-switch"
                    class="w-12 h-12 rounded-2xl glass-card flex items-center justify-center hover:scale-110 transition-transform">
                    <i id="theme-icon" class="fa-solid fa-moon text-brand-600 text-lg"></i>
                </button>
            </header>

            <div class="flex-1 overflow-y-auto px-8 pb-10 custom-scroll animate-slide-up">
                <div class="max-w-4xl mx-auto lg:mx-0">

                    {% if form.errors %}
                    <div
                        class="mb-8 overflow-hidden rounded-[2rem] border border-rose-500/20 bg-rose-500/5 backdrop-blur-md">
                        <div class="flex items-center gap-4 p-6 bg-rose-500/10">
                            <div
                                class="w-10 h-10 rounded-full bg-rose-500 flex items-center justify-center text-white shadow-lg shadow-rose-500/40">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                            </div>
                            <h4 class="font-black text-rose-500 uppercase tracking-widest text-sm">Action Required</h4>
                        </div>
                        <div class="p-6 pt-2">
                            <ul class="space-y-3">
                                {% for field, errors in form.errors.items %}
                                <li class="flex items-center gap-3 text-sm font-bold text-rose-600 dark:text-rose-400">
                                    <span class="w-1.5 h-1.5 rounded-full bg-rose-500"></span>
                                    <span class="uppercase opacity-60 text-[10px]">{{ field }}:</span>
                                    {{errors|striptags }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    {% endif %}

                    <div class="glass-card rounded-[3rem] p-8 lg:p-12 relative overflow-hidden">
                        <div
                            class="absolute top-0 right-0 w-64 h-64 bg-brand-500/5 rounded-full -mr-32 -mt-32 blur-3xl">
                        </div>

                        <form id="profile-form" method="POST" class="space-y-10 relative z-10">
                            {% csrf_token %}

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-10">
                                <div class="space-y-3 group">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1 group-focus-within:text-brand-500 transition-all duration-300">Institution
                                        Name</label>
                                    <div class="relative flex items-center">
                                        <input type="text" name="institution_name"
                                            value="{{ institution.institution_name }}" required
                                            class="input-field pr-16 truncate overflow-ellipsis {% if form.institution_name.errors %}border-rose-500{% endif %}"
                                            placeholder="Institution Name">
                                        <div
                                            class="absolute right-4 w-9 h-9 flex items-center justify-center rounded-xl bg-slate-100/80 dark:bg-white/5 text-slate-400 group-focus-within:text-brand-500 group-focus-within:scale-110 transition-all duration-300 pointer-events-none">
                                            <i class="fa-solid fa-university text-sm"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-3 group">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1 group-focus-within:text-brand-500 transition-colors">Abbreviation</label>
                                    <div class="relative flex items-center">
                                        <input type="text" name="abbreviation" value="{{ institution.abbreviation }}"
                                            required
                                            class="input-field pr-16 {% if form.abbreviation.errors %}border-rose-500{% endif %}">
                                        <div
                                            class="absolute right-4 w-9 h-9 flex items-center justify-center rounded-xl bg-slate-100/80 dark:bg-white/5 text-slate-400 group-focus-within:text-brand-500 transition-colors pointer-events-none">
                                            <i class="fa-solid fa-tag text-xs"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-3"> <label for="institution-email"
                                        class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em] ml-1">
                                        Email Address
                                    </label>
                                    <div class="relative flex items-center group">
                                        <input type="email" id="institution-email" value="{{ institution.email }}"
                                            name="email" required
                                            class="w-full px-6 py-4 bg-white dark:bg-slate-900 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-800 rounded-2xl focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 transition-all duration-200 outline-none font-medium text-sm"
                                            placeholder="institution@example.com">
                                        <i
                                            class="fa-solid fa-pen-to-square absolute right-6 text-slate-300 group-focus-within:text-indigo-500 transition-colors"></i>
                                    </div>
                                </div>

                                <div class="space-y-3 group">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1 group-focus-within:text-brand-500 transition-colors">Security
                                        Access Key</label>
                                    <div class="relative flex items-center">
                                        <input type="password" id="pass-field" name="password"
                                            value="{{ institution.password }}"
                                            class="input-field pr-14 {% if form.password.errors %}border-rose-500{% endif %}"
                                            placeholder="••••••••">
                                        <div
                                            class="absolute right-5 text-slate-400 group-focus-within:text-brand-500 transition-colors pointer-events-none">
                                            <i class="fa-solid fa-shield-halved"></i>
                                        </div>
                                    </div>
                                    <p class="text-[10px] font-bold text-slate-400 italic">Reveals on focus</p>

                                    <!-- Password Validation UI -->
                                    <div id="password-validation"
                                        class="mt-4 p-4 rounded-2xl bg-slate-50/50 dark:bg-white/5 border border-slate-200/50 dark:border-white/10 space-y-2 hidden">
                                        <p class="text-[10px] font-black text-brand-500 uppercase tracking-widest">
                                            Password Requirements</p>
                                        <div class="grid grid-cols-2 gap-2">
                                            <div id="v-len"
                                                class="flex items-center gap-2 text-[9px] font-bold uppercase text-rose-500">
                                                <i class="fa-solid fa-shield text-[8px]"></i> 6+ Characters
                                            </div>
                                            <div id="v-up"
                                                class="flex items-center gap-2 text-[9px] font-bold uppercase text-rose-500">
                                                <i class="fa-solid fa-font text-[8px]"></i> Uppercase
                                            </div>
                                            <div id="v-low"
                                                class="flex items-center gap-2 text-[9px] font-bold uppercase text-rose-500">
                                                <i class="fa-solid fa-italic text-[8px]"></i> Lowercase
                                            </div>
                                            <div id="v-num"
                                                class="flex items-center gap-2 text-[9px] font-bold uppercase text-rose-500">
                                                <i class="fa-solid fa-hashtag text-[8px]"></i> Number
                                            </div>
                                            <div id="v-spl"
                                                class="flex items-center gap-2 text-[9px] font-bold uppercase text-rose-500">
                                                <i class="fa-solid fa-percent text-[8px]"></i> Special
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="pt-6 flex flex-wrap items-center gap-4">
                                <button type="submit" id="submit-btn" disabled
                                    class="group relative overflow-hidden px-10 py-5 bg-brand-600 rounded-2xl font-black text-[11px] uppercase tracking-[0.15em] text-white shadow-xl shadow-brand-500/20 hover:-translate-y-1 transition-all active:scale-95 opacity-50 cursor-not-allowed">
                                    <span class="relative z-10">Save Profile Changes</span>
                                    <div
                                        class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-shimmer">
                                    </div>
                                </button>
                                <a href="{% url 'institution:dashboard' %}"
                                    class="px-10 py-5 border border-slate-200 dark:border-white/10 rounded-2xl font-black text-[11px] uppercase tracking-widest text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors inline-block text-center">
                                    Discard
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // DOM Elements
        const themeSwitch = document.getElementById('theme-switch');
        const themeIcon = document.getElementById('theme-icon');
        const menuBtn = document.getElementById('menu-btn');
        const sidebar = document.getElementById('sidebar');
        const passField = document.getElementById('pass-field');

        // Theme Toggle Logic
        function updateThemeUI(isDark) {
            themeIcon.className = isDark ? 'fa-solid fa-sun text-lg text-yellow-400' : 'fa-solid fa-moon text-lg text-brand-600';
        }

        themeSwitch.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.theme = isDark ? 'dark' : 'light';
            updateThemeUI(isDark);
        });
        updateThemeUI(document.documentElement.classList.contains('dark'));

        // Password Reveal and Validation UI Logic
        if (passField) {
            passField.addEventListener('focus', () => {
                passField.type = 'text';
                // Show password validation requirements when focused
                document.getElementById('password-validation').classList.remove('hidden');
            });
            passField.addEventListener('blur', () => {
                passField.type = 'password';
                // Hide validation requirements when field loses focus
                setTimeout(() => {
                    document.getElementById('password-validation').classList.add('hidden');
                }, 300); // Small delay to allow for clicking validation items if needed
            });

            // Real-time password validation
            passField.addEventListener('input', (e) => {
                const password = e.target.value;
                validatePassword(password);
            });
        }

        // Password validation function
        function validatePassword(password) {
            const validators = {
                len: password.length >= 6,
                up: /[A-Z]/.test(password),
                low: /[a-z]/.test(password),
                num: /[0-9]/.test(password),
                spl: /[^A-Za-z0-9]/.test(password)
            };

            Object.keys(validators).forEach(key => {
                const element = document.getElementById(`v-${key}`);
                if (element) {
                    if (validators[key]) {
                        element.classList.remove('text-rose-500');
                        element.classList.add('text-emerald-500');
                    } else {
                        element.classList.remove('text-emerald-500');
                        element.classList.add('text-rose-500');
                    }
                }
            });

            // Enable/disable submit button based on validation
            const submitBtn = document.querySelector('button[type="submit"]');
            const allValid = Object.values(validators).every(check => check);

            if (submitBtn) {
                if (allValid) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    submitBtn.disabled = true;
                    submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }
        }

        // Mobile Sidebar
        menuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            sidebar.classList.toggle('-translate-x-full');
        });

        const closeSidebarBtn = document.getElementById('close-sidebar');
        if (closeSidebarBtn) {
            closeSidebarBtn.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
            });
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && window.innerWidth < 1024) {
                sidebar.classList.add('-translate-x-full');
            }
        });

        // Spotlight Effect
        window.addEventListener('mousemove', e => {
            document.getElementById('spotlight').style.setProperty('--x', `${e.clientX}px`);
            document.getElementById('spotlight').style.setProperty('--y', `${e.clientY}px`);
        });

        // Initial validation on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Run initial password validation if password field exists
            if (passField && passField.value) {
                validatePassword(passField.value);
            }

            // Notification Auto-Removal
            const notifications = document.querySelectorAll('.success-toast');
            if (notifications.length > 0) {
                setTimeout(() => {
                    notifications.forEach(el => {
                        el.style.opacity = '0';
                        el.style.transform = 'translateY(-20px)';
                        setTimeout(() => el.remove(), 600);
                    });
                }, 3000);
            }
        });
    </script>
</body>

</html>